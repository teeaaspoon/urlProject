<% include partials/_header.ejs %>
    <main>
        <h2>Your Links</h2>
        <% if (userInfo) { %>
            <table>
                <tr>
                    <th>Short Link</th>
                    <th>Long Link</th>
                    <th>Times Visted</th>
                    <th>Unique Visitors</th>
                </tr>

                <% userInfo["links"].forEach(function(element){ %>
                <tr>
                    <td>
                        <a href="/u/<%=element%>">/u/<%=element%></a>
                    </td>
                    <td>
                        <%= urls[element]["longURL"] %>
                    </td>
                    <td><%= urls[element]["visits"].length%></td>
                    <td><%= calculateUniquePageViews(urls[element]["visits"])%></td>
                    <td>
                        <a href="/urls/<%=element%>">
                            <button class="btn btn-warning">Edit</button>
                        </a>
                    </td>
                    <td>
                        <form method="post" action="/urls/<%= element %>?_method=DELETE">
                            <input type="submit" value="delete" class="btn btn-danger">
                        </form>
                    </td>
                </tr>
                <% }); %>
            </table>
            <% } else { %>
             <p>Please login or register first</p>
            <% } %>
    </main>
<% include partials/_footer.ejs %>


<% function calculateUniquePageViews(arrayOfVisits) {
    var uniqueVisitorArray = [];
    var count = 0
    arrayOfVisits.forEach(function (element) {
        if (uniqueVisitorArray.includes(element[1])){
            // do nothing
        } else {
            uniqueVisitorArray.push(element[1]);
            count += 1;
        }
    });
    return count;
}%>